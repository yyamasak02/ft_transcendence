### 目的と指示の明確化

下記の開発ルールとアーキテクチャ方針に基づき、**コードの品質、保守性、TypeScriptの恩恵を最大限に引き出す設計**となっているかを重点的にレビューしてください。
**業務ロジック／ゲームロジックの妥当性**についても確認してください。

---

### レビュー対象の構成情報

#### 1. 使用言語

- 日本語

#### 2. 技術スタック

| 分野               | 技術                                     | 特記事項                   |
| :----------------- | :--------------------------------------- | :------------------------- |
| **バックエンド**   | Fastify (TypeScript), sqlite3            | マイクロサービスごとに分割 |
| **フロントエンド** | vanilla TypeScript, tailwind, babylon.js | -                          |

#### 3. 全体フォルダ構造

- **backends:** マイクロサービスごとのバックエンドコードを格納
- **frontend:** フロントエンドコードを格納
- **mock:** モックデータ
- **nginx:** リバースプロキシ設定
- **subjects:** 今回の要件資料

#### 4. レビュー時の記載内容

下記のフォーマットに従いレビューを回答してください。

- 優先度：（低/中/高）：動作に影響を及ぼすものを高、品質影響を出すものを中、単なるtypoやより良い提案は低
- 指摘内容
- 改善案
- 想定工数（人力の場合）（/h）

---

### アーキテクチャとフォルダ構造の遵守事項

#### 1. アーキテクチャ方針

- **マイクロサービス** アーキテクチャを採用しています。
- 示されたフォルダ構造を厳密に遵守しているかを確認してください。

#### 2. バックエンドフォルダ構造 (`backends/XXXX/`)

    backends/XXXX/
    ├── srcs/                   # ソースコード
    │   ├── plugins/           # Fastifyプラグイン
    │   │   ├── app/           # アプリケーションプラグイン
    │   │   └── external/      # 外部プラグイン
    │   ├── routes/            # APIルート定義
    │   │   └── api/
    │   ├── schemas/           # TypeBox スキーマ定義
    │   │   └── xxx.ts         #
    │   ├── utils/             # ユーティリティ（空）
    │   ├── app.ts             # Fastifyアプリケーション設定
    │   └── index.ts           # エントリーポイント
    ├── scripts/               # スクリプトファイル
    │   ├── migrate.ts         # マイグレーション処理
    │   └── seed.ts            # シード処理
    ├── init_db/               # データベース初期化
    │   ├── migrations/        # マイグレーションファイル
    │   │   └── 001_create_users.sql
    │   └── seeders/           # シードファイル
    │       └── 001_users.csv
    ├── db/                    # SQLiteデータベース格納
    ├── dist/                  # ビルド出力ディレクトリ
    ├── docker/                # Docker設定
    │   └── Dockerfile
    ├── package.json           # 依存関係
    └── tsconfig.json          # TypeScript設定

#### 3. フロントエンドフォルダ構造

frontend
├── index.html # エントリーポイントHTML
├── package.json # プロジェクトの依存関係と設定
├── tsconfig.json # TypeScript設定ファイル
├── vite.config.ts # Viteビルドツール設定
├── public/ # 静的ファイル
└── src/ # ソースコード
├── main.ts # アプリケーションのエントリーポイント
├── style.css # グローバルスタイル
├── vite-env.d.ts # Vite環境の型定義
├── components/ # 再利用可能なコンポーネント
│ ├── navbar.ts # ナビゲーションバーコンポーネント
│ └── navbar.css # ナビゲーションバーのスタイル
├── pages/ # ページコンポーネント
│ ├── 404/
│ │ └── index.ts # 404エラーページ
│ ├── home/
│ │ └── index.ts # ホームページ
│ └── pingpong/ # ピンポンゲームページ
│ ├── index.ts # ピンポンメインページ
│ ├── styles.css # ピンポンページのスタイル
│ └── scripts/ # ゲームロジック
├── router/ # ルーティング関連
│ ├── index.ts # ルーターエクスポート
│ ├── router.ts # ルーター実装
│ └── routes.ts # ルート定義
└── types/ # TypeScript型定義
├── component.ts # コンポーネントの型
└── routes.ts # ルーティングの型

---

### アンチパターン

以下の項目は、**コード品質、特にTypeScriptのメリットを損なわない設計**のために厳しくチェックし、改善案を提案してください。

1.  **TypeScriptの型安全性:**
    - **暗黙的・強制的な型変換**の使用を抑制し、可能な限り明示的な型定義を推奨してください。
    - `any` 型の使用は、ライブラリの型定義が存在しないなど、**やむを得ない場合に限定**されているか確認し、その場合でも使用範囲を最小限に抑えるよう提案してください。

2.  **変数・定数の管理:**
    - マジックナンバー、マジックストリング、共通設定値などが**散在していないか**チェックしてください。
    - 一か所に集約可能（例：定数ファイル、環境変数ファイル）なものは、**集中管理する構造**を推奨してください。

---

### 追加指示

- **保守性の観点:** 示されたフォルダ構造や命名規則が、将来的な機能追加や修正に耐えうるか（**凝集度が高く、結合度が低いか**）を評価してください。
- **セキュリティの観点:** FastifyやSQLite3の使用において、基本的なセキュリティ対策（例：入力値検証、SQLインジェクション対策）が講じられているか、懸念点があれば指摘してください。
- 要件資料（`subjects/`）に対して、ロジックが過不足なく実装されているか
- 状態遷移や処理フローが不自然・冗長になっていないか
- 処理の責務分割が適切か（1関数・1クラスが過剰な責務を持っていないか）
- 明らかなバグにつながりそうな条件分岐や前提がないか
- 将来的な拡張（ルール追加・仕様変更）を考えたときに破綻しにくい構造か
