# ft_transcendence
## Surprise.

---

## 概要：

このプロジェクトでは、これまでに経験したことのないタスクに取り組みます。  
コンピュータサイエンスの旅の始まりを思い出してください。  
今のあなたなら輝けます！

**バージョン: 16.1**

---

# 目次

- I. 序文 — 2ページ
- II. 目的 — 3ページ
- III. 必須項目 — 4ページ
  - III.1 概要 — 4ページ
  - III.2 最低技術要件 — 5ページ
  - III.3 ゲーム — 6ページ
  - III.4 セキュリティに関する注意 — 7ページ
- IV. モジュール — 8ページ
  - IV.1 概要 — 9ページ
  - IV.2 ウェブ — 11ページ
  - IV.3 ユーザー管理 — 12ページ
  - IV.4 ゲームプレイとユーザー体験 — 14ページ
  - IV.5 AI・アルゴリズム — 16ページ
  - IV.6 サイバーセキュリティ — 18ページ
  - IV.7 DevOps — 20ページ
  - IV.8 グラフィックス — 22ページ
  - IV.9 アクセシビリティ — 23ページ
  - IV.10 サーバーサイド・ポン — 25ページ
- V. ボーナスパート — 27ページ
- VI. 提出とピアレビュー — 28ページ

---

# 第III章
## 必須課題

このプロジェクトでは、「Pongコンテスト」のためのウェブサイトを作成します！

---

## III.1 概要

あなたのソフトウェアは、魅力的なユーザーインターフェースとリアルタイムマルチプレイヤー機能を提供し、友達と一緒にPongをプレイできるようにします！

- まず、プロジェクトは必須ガイドライン（次のセクション参照）に従う必要があります。これは最終評価のごく一部を占めます。
- 次に、追加モジュールを導入することで、必須部分を補完または置き換えることができます。

この課題では、**緑色でハイライトされた用語**が登場します。これらは時間とともに進化する技術選択肢を表しています。**常に最新バージョンに注意してください。**

- 即座に機能全体を実現するライブラリやツールの使用は禁止されています。
- サードパーティライブラリやツールに関する指示（使用可・必須・禁止）は厳守してください。
- 単純かつ限定的なタスクを解決する小規模ライブラリやツールの使用は許可されています。
- 評価時には、ガイドラインに明示的に承認されていないライブラリやツールの使用について、正当性を説明できなければなりません。
- 評価者は、特定のライブラリやツールの使用が適切かどうかを判断します。

---

## III.2 最低技術要件

プロジェクトは次のルールに準拠しなければなりません。
（一部の制約は、選択するモジュールによって上書きできます。）

- バックエンドの有無に関わらず、自由にサイトを開発できます。
  - バックエンドを使用する場合は、フレームワーク無しの純粋なPHPで記述する必要があります（ただし、フレームワークモジュールを使えばこの制約を解除可能です）。
  - バックエンドやフレームワークがデータベースを使用する場合は、データベースモジュールの制約に従ってください。
- フロントエンドはTypeScriptを基本コードとして使用します（FrontEndモジュールで変更可能）。
- ウェブサイトは**シングルページアプリケーション**でなければなりません。ブラウザの「戻る」「進む」ボタンも機能する必要があります。
- 最新の安定版**Mozilla Firefox**と互換性がなければなりません（もちろん他のブラウザにも対応可能です）。
- ウェブサイト閲覧中に未処理のエラーや警告が発生してはいけません。
- Dockerを使用してウェブサイトを実行する必要があります。単一のコマンドで自律型コンテナを立ち上げられること。

> **コンテナ環境の注意：**
> - 実行環境は `/goinfre` または `/sgoinfre` に配置する必要がある場合があります。
> - ルート権限なしでコンテナを起動する場合、ホストとコンテナ間のボリュームバインドマウントは使用できないことがあります。

このような場合、次のような対策を検討する必要があります：

- 仮想マシン内でコンテナを利用する
- 変更後にコンテナを再構築する
- ルートUIDのみを使った独自のイメージを作成する

---

## III.3 ゲーム

このウェブサイトの主目的は、他のプレイヤーとPongをプレイすることです！

- ユーザーはウェブサイト上で他プレイヤーとライブ対戦できなければなりません。最初は**同じキーボード**を使います（リモートプレイヤーモジュールを使えば遠隔対戦可能）。
- プレイヤー同士の対戦機能に加え、トーナメント機能も実装する必要があります。
- トーナメントでは、複数プレイヤーが順番に対戦します。対戦表や順番が明示されている必要があります。
- 登録システムを用意する必要があります。トーナメント開始時に各プレイヤーがエイリアス（名前）を入力し、トーナメント開始ごとにリセットされます（ユーザー管理モジュールで変更可能）。
- マッチメイキングシステムを実装し、次の試合を案内できるようにします。
- すべてのプレイヤーは**同じ速度のパドル**を使う必要があります（AIも同様）。
- フロントエンドの基本要件（上記）に従うか、FrontEndモジュールまたはGraphicsモジュールで拡張できます。ただし**1972年版Pong**のエッセンスは保持すること。

再掲ですが：

- 即座に機能全体を実現するライブラリやツールの使用は禁止されています。
- サードパーティライブラリやツールに関する指示は厳守してください。
- 小規模なライブラリやツールの使用は許可されています。
- 評価時に正当性の説明が必要です。
- 評価者が許可・禁止を判断します。

---

## III.4 セキュリティ対策

実用的なウェブサイトを作成するため、以下のセキュリティ対策を講じる必要があります：

- データベースに保存するパスワードは**必ずハッシュ化**すること。
- ウェブサイトは**SQLインジェクション**や**XSS攻撃**から保護されていなければなりません。
- バックエンドやその他の機能がある場合、**HTTPS通信**を必須とします（例：wssを使う）。
- バリデーション機構を実装してください：
  - バックエンド無しならページ側で、
  - バックエンドありならサーバー側で検証すること。
- JWTセキュリティモジュールや2FAを使用しない場合でも、サイト全体のセキュリティを最優先してください。
- APIを作成する場合は、ルート保護も必須です。

> **重要注意点：**
> - パスワードハッシュには安全なアルゴリズムを使用してください。
> - 認証情報、APIキー、環境変数などは必ず**ローカルの `.env` ファイルに保存し、Gitに登録しないこと**。
> - **公開された認証情報があるとプロジェクトは失格**になります。

---



# 第IV章
## モジュール

ここまででプロジェクトの25%を達成しました。おめでとうございます！  
基本的なWebサイトが完成した今、次のステップはさらなる改善のためにモジュールを選択することです。  
プロジェクトを100%達成するには、最低でも7つの主要モジュールの実装が必要です。  
各モジュールは既存のWebサイトに修正を加える必要がある場合があるため、全体を注意深く読むことを強く推奨します。

- 即座に機能全体を実現するライブラリやツールの使用は禁止されています。
- サードパーティライブラリやツールに関する具体的な指示（使用可能・必須・禁止）は厳守する必要があります。
- 単純で限定的なサブタスクを解決する小規模なライブラリやツールの使用は許可されています。
- 評価時には、使用したライブラリやツールについて、課題の制約に反していないか正当性を説明できる必要があります。
- 評価者は、ライブラリやツールの使用が適切か（許可）もしくは機能全体を解決してしまっているか（禁止）を判断します。

※マイナーモジュール2つでメジャーモジュール1つ分とみなされます。

---

## IV.1 概要

### Web
- **メジャーモジュール**：バックエンド構築にフレームワークを使用する
- **マイナーモジュール**：フロントエンド構築にフレームワークまたはツールキットを使用する
- **マイナーモジュール**：バックエンドにデータベースを使用する
- **メジャーモジュール**：トーナメントのスコアをブロックチェーンに保存する

### ユーザー管理
- **メジャーモジュール**：標準的なユーザー管理、認証、トーナメント間のユーザー管理
- **メジャーモジュール**：リモート認証の実装

### ゲームプレイとユーザー体験
- **メジャーモジュール**：リモートプレイヤー対応
- **メジャーモジュール**：同一ゲーム内に2人以上のマルチプレイヤー対応
- **メジャーモジュール**：別のゲームを追加し、ユーザー履歴・マッチメイキング対応
- **マイナーモジュール**：ゲームカスタマイズオプション追加
- **メジャーモジュール**：ライブチャット機能

### AI・アルゴリズム
- **メジャーモジュール**：AI対戦相手の導入
- **マイナーモジュール**：ユーザー・ゲーム統計ダッシュボード

### サイバーセキュリティ
- **メジャーモジュール**：WAF/ModSecurityの強化設定と、HashiCorp Vaultによる秘密管理の導入
- **マイナーモジュール**：GDPR対応（ユーザー匿名化、ローカルデータ管理、アカウント削除機能）
- **メジャーモジュール**：二要素認証（2FA）とJWTの実装

### DevOps
- **メジャーモジュール**：ログ管理インフラの設計
- **マイナーモジュール**：モニタリングシステムの導入
- **メジャーモジュール**：バックエンドをマイクロサービス設計にする

### グラフィックス
- **メジャーモジュール**：高度な3D技術の使用

### アクセシビリティ
- **マイナーモジュール**：すべてのデバイスに対応
- **マイナーモジュール**：ブラウザ互換性の拡張
- **マイナーモジュール**：複数言語サポート
- **マイナーモジュール**：視覚障害者向けアクセシビリティ機能追加
- **マイナーモジュール**：サーバーサイドレンダリング（SSR）の統合

### サーバーサイド・ポン
- **メジャーモジュール**：基本的なPongをサーバーサイド版に置き換え、APIを実装
- **メジャーモジュール**：CLI経由でWebユーザーと対戦できるPongプレイ機能の実装（API統合）


# IV.2 Web

これらのモジュールは、Pongゲームに高度なWeb機能を統合するためのものです。

- **メジャーモジュール：バックエンドにフレームワークを使用する**  
  Fastify（Node.js）を使ってバックエンドを構築します。  
  もしこのモジュールを使わない場合は、必須課題で指定されたデフォルトのバックエンド言語（PHP）を使って開発することも可能ですが、このモジュールを有効とするためには、要件を満たす必要があります。

- **マイナーモジュール：フロントエンドにフレームワークまたはツールキットを使用する**  
  フロントエンド開発では、TypeScriptに加えて**Tailwind CSS**を使用しなければなりません。他のCSSフレームワークやライブラリは使用禁止です。

- **マイナーモジュール：バックエンドにデータベースを使用する**  
  プロジェクトで使用するデータベースは**SQLite**に統一します。これにより、すべてのコンポーネント間でデータの一貫性と互換性が確保されます。  
  （バックエンドフレームワークモジュールなど、他モジュールの前提条件になる場合もあります。）

- **メジャーモジュール：トーナメントのスコアをブロックチェーンに保存する**  
  このモジュールでは、トーナメントスコアをブロックチェーン上に安全に保存します。  
  開発とテストには**Avalanche**というテスト用ブロックチェーン環境を使い、スマートコントラクトは**Solidity**で開発します。

  - **ブロックチェーン統合**：AvalancheとPongサイトを統合し、スコアを不正改ざんできない形で保存します。
  - **Solidityスマートコントラクト**：スコアの記録・管理・取得を担当するコントラクトを作成します。
  - **テスト用ブロックチェーン利用**：リスクを避けるため、本番環境ではなくテスト環境を使用します。
  - **他モジュールとの互換性**：特にバックエンドフレームワークモジュールとの連携が必要な場合があります。

---

# IV.3 ユーザー管理

このモジュールは、Pongプラットフォームにおけるユーザー管理と認証に関する機能を扱います。

- **メジャーモジュール：標準的なユーザー管理・認証・トーナメント間でのユーザー管理**  
  - ユーザーは安全にウェブサイトに登録できる
  - 登録ユーザーはログインできる
  - トーナメント用に一意の表示名を選択できる
  - ユーザー情報を更新できる
  - アバターをアップロードできる（未設定の場合はデフォルトアバター）
  - フレンド機能とオンラインステータス表示
  - プロフィールには勝敗数などの統計情報を表示
  - 1対1対戦履歴（日時・詳細）を保存、ログインユーザーが閲覧可能  
  ※ユーザー名・メールアドレスの重複管理は各自に委ねられます（合理的な解決策を設計すること）。

- **メジャーモジュール：リモート認証の実装（Googleサインイン）**  
  - Google認証システムを統合して、安全なログインを実現
  - 必要な認証情報・権限を取得してログインを許可
  - セキュリティ標準に沿ったログインフローを実装
  - 認証トークンとユーザー情報の安全なやり取りを行う

このモジュールは、リモートユーザー認証を導入して、安全かつ利便性の高いログイン手段を提供することを目的としています。

---

# IV.4 ゲームプレイとユーザー体験

ゲームプレイ体験を向上させるためのモジュールです。

- **メジャーモジュール：リモートプレイヤー対応**  
  2人のプレイヤーが**別々のコンピュータ**から同じウェブサイトにアクセスし、同じPongゲームをプレイできるようにします。  
  ネットワーク問題（切断、ラグ）にも配慮し、最高のユーザー体験を提供することが求められます。

- **メジャーモジュール：マルチプレイヤー対応**  
  2人以上（3人、4人、5人、6人以上）が同時にプレイできるようにします。  
  （例：4人なら正方形ボードの各辺を担当するなど自由に設計可。）

- **メジャーモジュール：新しいゲームの追加（ユーザー履歴・マッチメイキング付き）**  
  - Pongとは別に、新しいエンタメ性の高いゲームを作成
  - ユーザー個別のプレイ履歴を記録・表示
  - マッチメイキングシステムを実装してフェアな対戦を実現
  - パフォーマンス最適化と継続的なアップデートも必須

- **マイナーモジュール：ゲームカスタマイズオプション**  
  - パワーアップ、攻撃アイテム、異なるマップなどを追加
  - シンプル版（基本機能だけ）を選べるオプションも提供
  - すべてのゲームでカスタマイズ機能を一貫して適用
  - ユーザーフレンドリーな設定画面を用意

- **メジャーモジュール：ライブチャット機能**  
  - ユーザー同士で直接メッセージ送信
  - ブロック機能あり（ブロックされたら以降メッセージ不可）
  - チャット画面からPong対戦への招待が可能
  - トーナメントシステムから次の対戦通知
  - チャットから他プレイヤーのプロフィール閲覧も可能

---

# IV.5 AI・アルゴリズム

これらのモジュールは、プロジェクトにデータドリブンな要素を導入するためのものです。  
メジャーモジュールではAI対戦相手を追加し、ゲーム体験を強化します。マイナーモジュールではユーザーとゲーム統計のダッシュボードを提供し、プレイヤーの体験を可視化します。

- **メジャーモジュール：AI対戦相手の導入**
  - ゲーム内にAIプレイヤーを組み込むことが目標です。
  - **A*アルゴリズムの使用は禁止**されています。
  - 主な要件：
    - チャレンジ性と楽しさを提供するAIを開発する
    - **AIは人間のように振る舞う**必要があり、キーボード入力をシミュレートする
    - **AIは1秒に1回しかゲームの状態を認識できない**（バウンドを予測する必要あり）
    - カスタマイズ機能（パワーアップ等）を実装している場合は、AIもそれを使用する
    - A*以外のアルゴリズムで効果的なAIを開発する
    - シナリオに応じた適応能力を持たせる

  - **注意**：評価時にはAIの仕組みを詳細に説明する必要あり。何もしないAIは禁止。時には勝てるAIでなければならない。

- **マイナーモジュール：ユーザー・ゲーム統計ダッシュボード**
  - 各ユーザーやゲームセッションの統計を表示するダッシュボードを作成します。
  - 主な要件：
    - ユーザー向けに使いやすい統計ダッシュボードを作成
    - 各ゲームセッション向けの統計データ・結果・履歴のダッシュボード作成
    - チャートやグラフなど、視覚的にわかりやすいデータ表示を行う
    - ユーザーが自身のプレイ履歴・成績を簡単に閲覧できるようにする
    - 必要に応じて自由に追加メトリクスも導入可

---

# IV.6 サイバーセキュリティ

このセクションのモジュールは、プロジェクトのセキュリティ対策を強化することを目的としています。

- **メジャーモジュール：WAF/ModSecurity導入＋HashiCorp Vaultによるシークレット管理**
  - ウェブアプリケーションファイアウォール（WAF）とModSecurityを、厳格かつ安全な設定で導入します。
  - **HashiCorp Vault**を使って、APIキーや認証情報、環境変数などの機密情報を安全に保存・管理します。
  - 目的は、ウェブアプリ保護とシークレット管理による堅牢なセキュリティ基盤を構築することです。

- **マイナーモジュール：GDPR準拠オプション（ユーザー匿名化・ローカルデータ管理・アカウント削除）**
  - GDPR（EU一般データ保護規則）に対応する機能を提供します。
  - 主な要件：
    - ユーザーデータの匿名化リクエストに対応
    - ローカルデータ管理（閲覧・編集・削除）機能を提供
    - アカウントと関連データの完全削除機能を提供
    - ユーザーに対してデータプライバシー権を明確に伝える
  - **注意**：GDPRの理解が必要です。詳しくは[欧州委員会公式サイト](https://commission.europa.eu/law/law-topic/data-protection/data-protection-eu_en)を参照。

- **メジャーモジュール：二要素認証（2FA）とJWTの実装**
  - セキュリティとユーザー認証を強化するため、以下を導入します：
    - 2FA（二要素認証）：パスワード＋追加認証（SMSコード、認証アプリ、メールコードなど）
    - JWT（JSON Web Token）：安全なセッション管理と認可のために使用
    - 2FAの有効化をユーザーフレンドリーに提供する
    - JWTの発行・検証プロセスを厳格に管理し、不正アクセスを防止する

---

# IV.7 DevOps

このセクションでは、プロジェクトのインフラストラクチャとアーキテクチャの向上に焦点を当てます。

- **メジャーモジュール：ELK（Elasticsearch, Logstash, Kibana）によるログ管理インフラ構築**
  - 主な要件：
    - Elasticsearchをデプロイし、ログデータを効率的に保存・検索可能にする
    - Logstashでログ収集・処理・変換を行い、Elasticsearchに送信
    - Kibanaでログデータを可視化、ダッシュボードを作成、インサイトを得る
    - データ保持とアーカイブポリシーを定義
    - ログデータ保護とELKコンポーネントのアクセス制御を実施

- **マイナーモジュール：モニタリングシステムの構築**
  - **Prometheus**と**Grafana**を用いてモニタリングシステムを構築します。
  - 主な要件：
    - Prometheusで各コンポーネントのメトリクスを収集・監視
    - エクスポーター設定・統合により多様なサービス・DB・インフラを監視
    - Grafanaでカスタムダッシュボードを作成
    - Prometheusでアラートルールを設定し、異常検知を行う
    - メトリクスデータの保持・保存方針を策定
    - Grafanaの認証とアクセス制御を強化

- **メジャーモジュール：バックエンドのマイクロサービス設計**
  - システムのバックエンドをマイクロサービスアーキテクチャに設計します。
  - 主な要件：
    - 小さく独立したマイクロサービス群に分割し、それぞれが明確な役割を持つ
    - サービス間の明確なインターフェースと境界を定義
    - サービス間通信にはREST APIやメッセージキューなどを利用
    - それぞれのマイクロサービスが単一の明確な責務を持つように設計
  - 目的は、**柔軟性・拡張性・保守性**を向上させることです。

---

# IV.8 グラフィックス

- **メジャーモジュール：高度な3D技術の実装**
  - このモジュールでは、Pongゲームのビジュアル面を強化します。
  - **Babylon.js**を使用して、先進的な3Dグラフィックスを実装し、より没入感のあるゲーム体験を提供します。
  - 主な要件：
    - 高度な3Dグラフィックス技術を使ってゲームのビジュアルクオリティを向上させる
    - 3D技術により、視覚的に魅力的で没入感のあるPong体験を作り出す
    - Babylon.jsを使用し、互換性と最適なパフォーマンスを確保する

このモジュールは、Pongゲームにおける視覚表現を革新し、プレイヤーに没入型の体験を提供することを目指します。

---

# IV.9 アクセシビリティ

ウェブアプリケーションのアクセシビリティを向上させるためのモジュールです。

- **マイナーモジュール：すべてのデバイスに対応**
  - すべてのデバイス（PC、タブレット、スマホ）で一貫したユーザー体験を提供する。
  - 主な要件：
    - 異なる画面サイズ・向きに応じたレスポンシブデザインを実装
    - タッチスクリーン・キーボード・マウスなど様々な入力デバイスに対応

- **マイナーモジュール：ブラウザ互換性の拡張**
  - 新たなWebブラウザにも対応し、アプリの利用可能性を拡大します。
  - 主な要件：
    - 追加のブラウザをサポート対象に加える
    - 動作確認・最適化を徹底する
    - 表示崩れ・互換性問題を解消し、一貫したUXを提供する

- **マイナーモジュール：多言語サポート**
  - サイトに最低3つの言語対応を実装し、国際的なユーザー層に対応します。
  - 主な要件：
    - 言語切り替え機能の提供
    - 主要コンテンツ（メニュー・見出し・重要情報）の翻訳
    - 言語ごとの一貫性を保つ（言語パックやローカリゼーションライブラリの活用可）
    - ユーザーがデフォルト言語を設定できるようにする

- **マイナーモジュール：視覚障害者向けアクセシビリティ機能追加**
  - 視覚障害のあるユーザーにも使いやすいサイトを目指します。
  - 主な要件：
    - スクリーンリーダーや支援技術への対応
    - 画像の代替テキスト（alt属性）の設定
    - 高コントラスト配色
    - キーボード操作対応
    - テキストサイズ調整機能
    - アクセシビリティ基準に準拠するための定期的な更新

- **マイナーモジュール：サーバーサイドレンダリング（SSR）の統合**
  - サイトのパフォーマンスとUX向上を目指します。
  - 主な要件：
    - サーバー側でページを事前レンダリングし、高速な初期表示を実現
    - SEO向上のため、検索エンジンにプリレンダリング済みHTMLを提供
    - SSRによるパフォーマンス向上と一貫したユーザー体験を両立

---

# IV.10 サーバーサイドPong

- **メジャーモジュール：基本PongをサーバーサイドPongに置き換え、APIを実装**
  - 基本Pongをサーバーサイドで実装し、APIを介して操作できるようにします。
  - 主な要件：
    - ゲームプレイ、ボール移動、得点、プレイヤー操作などのロジックをサーバー側で管理
    - CLI（コマンドライン）やWebインターフェースからAPIを通じてPongにアクセス可能にする
    - APIエンドポイント設計（ゲーム開始、プレイヤー操作、ゲーム状態更新）
    - サーバーサイドPongをWebアプリに統合し、Webからプレイ可能にする

- **メジャーモジュール：CLI対WebユーザーのPongプレイ機能（API統合）**
  - CLIユーザーがWebユーザーと対戦できる仕組みを作ります。
  - 主な要件：
    - CLIアプリケーションを開発し、Pongプレイ体験を再現
    - APIを通じてCLIとWebアプリを連携させる
    - CLIユーザーが安全にログインできる認証機構の実装
    - CLIとWebユーザー間でリアルタイム同期を実現
    - CLIから試合作成・参加ができるようにする
    - CLIの使い方を丁寧にドキュメント化する

> **注意**  
> このモジュールを完了させるには、前述の「サーバーサイドPong」モジュールを先に完了しておくことを強く推奨します。

---

# 第V章
## ボーナスパート

このプロジェクトにおけるボーナスパートはシンプルに設計されています。  
追加モジュールを実装することで、ボーナスポイントを獲得できます。

- **マイナーモジュール**：1つあたり5ポイント
- **メジャーモジュール**：1つあたり10ポイント

⚠️ **注意**  
ボーナスパートは、**必須課題が完全に（PERFECT）達成された場合にのみ**評価されます。  
「完全」とは、必須課題がすべて正しく実装され、問題なく動作していることを意味します。  
必須課題を一つでも満たしていない場合、ボーナスパートは一切評価されません。

---

# 第VI章
## 提出とピアレビュー

- 通常通り、課題は**Gitリポジトリ**に提出します。
- **リポジトリ内の作業内容のみ**が評価対象となります（防衛・審査時）。
- ファイル名の正確さを必ず再確認してください。

また、以下のルールを遵守する必要があります：

- 即座に機能全体を実現するライブラリやツールの使用は禁止されています。
- サードパーティライブラリやツールに関する指示（使用可・必須・禁止）は厳守してください。
- 単純かつ限定的なタスクを解決する小規模ライブラリやツールの使用は許可されています。
- 評価時には、ガイドラインで明示されていないライブラリやツールの使用について、チームが正当性を説明できる必要があります。
- 評価者は、特定ライブラリやツールの使用が適切（許可）か、または機能全体を解決してしまっているか（禁止）を判断します。

---


